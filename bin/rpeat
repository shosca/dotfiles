#! /bin/bash

WATCH_EVENTS=modify,close_write,moved_to,create

if [ -z "$1" ]; then
  echo "rpeat <command to run over and over on file change>"
  exit 1
fi

if [ -x "$(command -v inotifywait)" ]; then
  echo "Watching $(pwd) to run: $@"
  while true; do
    $@
    inotifywait -e $WATCH_EVENTS -r --exclude '.*(git|~)' . ;
  done
elif [ -x "$(command -v entr)" ]; then
  ag -l | entr "$@"
  exit 0
fi

echo "Please install inotify-tools or entr"
echo "If you using mac follow https://medium.com/mindful-technology/too-many-open-files-limit-ulimit-on-mac-os-x-add0f1bfddde"
exit 1



